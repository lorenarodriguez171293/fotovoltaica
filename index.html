<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador Fotovoltaico - Secundaria</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#0b74de;--muted:#6b7280}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:var(--bg); color:#111}
    .container{max-width:1000px;margin:28px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center}
    h1{margin:0;font-size:1.25rem}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(11,20,40,0.06)}
    label{display:block;font-size:0.85rem;color:var(--muted);margin-bottom:6px}
    input[type=number], input[type=range], select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef8;font-size:0.95rem}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .btn{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    .results{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .result-item{padding:10px;border-radius:8px;background:#f8fbff;text-align:center}
    .muted{color:var(--muted);font-size:0.85rem}
    .chart{margin-top:12px}
    footer{margin-top:18px;font-size:0.82rem;color:var(--muted)}
    @media (max-width:880px){.grid{grid-template-columns:1fr;}.results{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" aria-hidden>
        <rect x="2" y="9" width="20" height="10" rx="1.5" fill="#0b74de"/>
        <path d="M6 9V6a4 4 0 018 0v3" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <div>
        <h1>Simulador fotovoltaico (versión educativa)</h1>
        <div class="muted">Introduce parámetros y observa la energía estimada por día, mes y año.</div>
      </div>
    </header>

<!-- Animación de fotones impactando en paneles solares -->
<div style="text-align:center; margin:20px 0;">
  <svg id="animSolar" width="100%" height="220" viewBox="0 0 600 220">
    <!-- Sol -->
    <circle cx="80" cy="80" r="35" fill="orange" stroke="#ff7b00" stroke-width="4"></circle>

    <!-- Panel solar -->
    <rect x="350" y="100" width="180" height="80" fill="#005b96" stroke="#003f63" stroke-width="3"></rect>
    <line x1="350" y1="130" x2="530" y2="130" stroke="#003f63" stroke-width="2"></line>
    <line x1="350" y1="150" x2="530" y2="150" stroke="#003f63" stroke-width="2"></line>
    <line x1="350" y1="170" x2="530" y2="170" stroke="#003f63" stroke-width="2"></line>

    <!-- Fotones animados -->
    <g id="photons"></g>
  </svg>
</div>

<script>
// Animación de fotones (círculos amarillos moviéndose hacia el panel)
(function(){
  const svg = document.getElementById('animSolar');
  const photonsGroup = document.getElementById('photons');

  function createPhoton(){
    const photon = document.createElementNS('http://www.w3.org/2000/svg','circle');
    photon.setAttribute('cx', 120);
    photon.setAttribute('cy', 80 + Math.random()*80 - 40);
    photon.setAttribute('r', 6);
    photon.setAttribute('fill', '#ffcc00');
    photon.setAttribute('opacity', '0.9');
    photonsGroup.appendChild(photon);

    let x = 120;
    const targetX = 350;

    function move(){
      x += 2 + Math.random()*1.5;
      photon.setAttribute('cx', x);

      if(x < targetX){
        requestAnimationFrame(move);
      } else {
        photonsGroup.removeChild(photon);
      }
    }
    move();
  }

  // Crear fotones continuamente
  setInterval(createPhoton, 300);
})();
</script>



    <div class="grid">
      <!-- Panel izquierdo: controles -->
      <section class="card" aria-labelledby="controles-title">
        <h2 id="controles-title" style="margin-top:0;font-size:1rem">Parámetros del sistema</h2>

        <label for="panel-w">Potencia por panel (W)</label>
        <input id="panel-w" type="number" step="1" min="1" value="320" />

        <label for="n-panels">Cantidad de paneles</label>
        <input id="n-panels" type="number" step="1" min="1" value="6" />

        <div style="display:flex;gap:10px;margin-top:8px">
          <div style="flex:1">
            <label for="psh">Horas pico de sol (h/día)</label>
            <input id="psh" type="number" step="0.1" min="0" value="4.5" />
          </div>
          <div style="flex:1">
            <label for="loss">Pérdidas del sistema (%)</label>
            <input id="loss" type="number" step="0.1" min="0" max="100" value="14" />
          </div>
        </div>

        <label for="eff">Eficiencia estimada del sistema (%)</label>
        <input id="eff" type="number" step="0.1" min="1" max="100" value="90" />

        <label for="latitude">Provincia / latitud aproximada</label>
        <select id="latitude">
          <option value="-34.6">Buenos Aires (lat -34.6)</option>
          <option value="-31.4">Córdoba (-31.4)</option>
          <option value="-38.7">Patagonia - Chubut (-43)</option>
          <option value="-24.8">Salta (-24.8)</option>
          <option value="-68">Otra / manual</option>
        </select>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="calc" class="btn">Calcular</button>
          <button id="reset" class="btn" style="background:#9aaed6">Restablecer</button>
        </div>

        <div class="muted" style="margin-top:12px">Nota: este simulador entrega estimaciones pedagógicas, no es un proyecto técnico final.</div>
      </section>

      <!-- Panel derecho: resultados y gráfico -->
      <aside class="card" aria-labelledby="resultados-title">
        <h2 id="resultados-title" style="margin-top:0;font-size:1rem">Resultados</h2>

        <div class="results" id="summary">
          <div class="result-item">
            <div class="muted">Energía diaria</div>
            <div style="font-weight:700;font-size:1.1rem" id="daily">-- kWh/día</div>
          </div>
          <div class="result-item">
            <div class="muted">Energía mensual (prom.)</div>
            <div style="font-weight:700;font-size:1.1rem" id="monthly">-- kWh/mes</div>
          </div>
          <div class="result-item">
            <div class="muted">Energía anual</div>
            <div style="font-weight:700;font-size:1.1rem" id="annual">-- kWh/año</div>
          </div>
          <div class="result-item">
            <div class="muted">CO₂ evitado (aprox.)</div>
            <div style="font-weight:700;font-size:1.1rem" id="co2">-- kg CO₂/año</div>
          </div>
        </div>

        <div class="chart card" style="margin-top:12px;padding:10px">
          <div class="muted">Producción estimada por mes</div>
          <svg id="bars" width="100%" height="160" role="img" aria-label="Gráfico de barras mensual"></svg>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <label class="muted" style="margin:0;flex:1">Factor de emisión CO₂ (kg CO₂ / kWh)</label>
          <input id="co2factor" type="number" step="0.01" value="0.45" style="width:90px" />
        </div>

      </aside>
    </div>

    <footer class="muted">Cómo usar: cambia los parámetros y presiona "Calcular". Ideal para actividades de aula.</footer>
  </div>

  <script>
    // Helpers
    const qs = (s)=>document.querySelector(s);
    const n = (id)=>Number(qs(id).value);

    function daysInMonth(m){ return new Date(2024,m,0).getDate(); }

    // Estimación mensual: aplicamos una variación estacional simple según latitud
    function seasonFactors(lat){
      // For simplicity: generate 12 multipliers (0.7 - 1.3 range) shifted by latitude
      // Northern hemisphere inverted vs southern: latitude negative -> southern
      const base = [];
      for(let i=0;i<12;i++){
        // simple sinusoid: peak in January (mid-summer southern) -> shift by lat
        const theta = (i/12)*2*Math.PI;
        base.push(1 + 0.25*Math.sin(theta - (lat/90)) );
      }
      // normalize roughly to average 1
      const avg = base.reduce((a,b)=>a+b,0)/12;
      return base.map(x=>x/avg);
    }

    function calculate(){
      const panelW = n('#panel-w');
      const panels = n('#n-panels');
      const psh = n('#psh');
      const lossesPct = n('#loss')/100;
      const effPct = n('#eff')/100;
      const lat = Number(qs('#latitude').value);
      const co2factor = n('#co2factor');

      // DC system rated power (kW)
      const systemKW = (panelW * panels)/1000; // kW

      // Energía diaria (kWh) aproximada: systemKW * PSH * eficiencia neta
      const netFactor = effPct * (1 - lossesPct);
      const daily = systemKW * psh * netFactor; // kWh/día

      // Monthly and annual estimates with seasonality
      const months = Array.from({length:12},(_,i)=>i+1);
      const season = seasonFactors(lat);
      const monthly = months.map((m,i)=>{
        const days = daysInMonth(m);
        // vary PSH per month by seasonal factor
        const monthlyEnergy = systemKW * psh * season[i] * netFactor * days;
        return monthlyEnergy;
      });
      const annual = monthly.reduce((a,b)=>a+b,0);
      const monthlyAvg = annual/12;
      const co2saved = annual * co2factor; // kg CO2/year

      // Update UI
      qs('#daily').textContent = daily.toFixed(2) + ' kWh/día';
      qs('#monthly').textContent = monthlyAvg.toFixed(1) + ' kWh/mes';
      qs('#annual').textContent = annual.toFixed(0) + ' kWh/año';
      qs('#co2').textContent = co2saved.toFixed(0) + ' kg CO₂/año';

      drawBars(monthly);
    }

    function drawBars(values){
      const svg = qs('#bars');
      while(svg.firstChild) svg.removeChild(svg.firstChild);
      const w = svg.clientWidth || 800;
      const h = 160;
      svg.setAttribute('viewBox',`0 0 ${w} ${h}`);

      const max = Math.max(...values);
      const pad = 18;
      const barW = (w - pad*2) / values.length * 0.75;
      const gap = ((w - pad*2)/values.length) - barW;

      values.forEach((v,i)=>{
        const x = pad + i*(barW+gap);
        const barH = (v / max) * (h - 48);
        const y = h - barH - 24;

        const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', y);
        rect.setAttribute('width', barW);
        rect.setAttribute('height', barH);
        rect.setAttribute('rx', 4);
        rect.setAttribute('fill', '#0b74de');
        svg.appendChild(rect);

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', x + barW/2);
        label.setAttribute('y', h - 6);
        label.setAttribute('text-anchor','middle');
        label.setAttribute('font-size','11');
        label.setAttribute('fill','#334155');
        const monthNames = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
        label.textContent = monthNames[i];
        svg.appendChild(label);
      });
    }

    // Events
    qs('#calc').addEventListener('click',()=>{
      try{ calculate(); }catch(e){ alert('Error en cálculo: '+e.message); }
    });

    qs('#reset').addEventListener('click',()=>{
      qs('#panel-w').value = 320;
      qs('#n-panels').value = 6;
      qs('#psh').value = 4.5;
      qs('#loss').value = 14;
      qs('#eff').value = 90;
      qs('#latitude').value = -34.6;
      qs('#co2factor').value = 0.45;
      qs('#daily').textContent = '-- kWh/día';
      qs('#monthly').textContent = '-- kWh/mes';
      qs('#annual').textContent = '-- kWh/año';
      qs('#co2').textContent = '-- kg CO₂/año';
      const svg = qs('#bars'); while(svg.firstChild) svg.removeChild(svg);
    });

    // Auto-calc first view
    window.addEventListener('load',()=>{ calculate(); });
  </script>
</body>
</html>
